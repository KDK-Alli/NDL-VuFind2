<!-- START of: finna - Helpers/nkrRestrictedRecordPermission.phtml -->
<? "id: " . var_export($this->id, true) . ", status: " . var_export($this->status, true) . ", call: " . var_export($this->callApi, true) . ", not submitted: " . var_export($this->notSubmitted, true) . ", autoopen: " . var_export($this->autoOpen, true) ?>
<?php
  $setupJS = false;
  $registerFormUrl =
    $this->url('feedback-form', ['id' => 'NkrRegister'])
      . '?recordId=' . $this->escapeHtmlAttr($this->id)
      . ($this->collection ? '&collection=1' : '');
?>

<?php if (!$this->user): ?>
  <?php 
    $setupJS = <<<JS
$(document).ready(function() {
   finna.nkr.initModal();
});
JS;
  ?>
  <div class="alert alert-info authorization-notification nkr-status">
    <p><?= $this->translate('nkr_restricted_record_note_html') ?></p>
    <p class="register"><a href="<?= $registerFormUrl ?>" data-lightbox data-lightbox-title="<?=$this->transEsc("nkr_register_form_title")?>" class="btn btn-primary"><?=$this->transEsc("nkr_register")?></a></p>
  </div>
<?php elseif ($this->status === 'approved'): ?>
  <div class="alert alert-info authorization-notification check-permission nkr-status nkr-status-approved">
    <p><?=$this->translate('nkr_restricted_record_registered_note_html')?></p>
  </div>
<?php else: ?>
  <? if ($this->callApi): ?>
    <?php 
      $setupJS = <<<JS
$(document).ready(function() {
   finna.nkr.initModal();
   finna.nkr.initCheckPermission("{$this->id}");
});
JS;
    ?>
  <?php else: ?>
    <?php 
      $setupJS = <<<JS
$(document).ready(function() {
   finna.nkr.initModal();
});
JS;
    ?>
  <? endif ?>
  <div class="alert alert-info authorization-notification check-permission nkr-status nkr-status-not-submitted<?= $this->status === null || $this->status !== 'not-submitted' ? ' hide' : ''?>" data-id="<?=$this->escapeHtmlAttr($this->id)?>">
    <p class="txt"><?= $this->translate('nkr_restricted_record_note_html') ?></p>
    <p class="register"><a href="<?= $registerFormUrl ?>" class="btn btn-primary" data-lightbox title="<?=$this->transEsc('nkr_register_form_title')?>"><?=$this->translate('nkr_register')?></a></p>
  </div>
  <? if (!$this->translationEmpty("nkr_permission_request_status_submitted")): ?>
    <div class="alert alert-info authorization-notification nkr-status nkr-status-submitted<?= $this->status === null || $this->status === 'not-submitted' ? ' hide' : ''?>">
      <p class="txt"><?= $this->transEsc("nkr_permission_request_status_submitted") ?></p>
    </div>
  <? endif; ?>
<? endif; ?>

<?php if ($autoOpen && $this->status === null): ?>
  <?php    
  $setupJS .= <<<JS
$(document).ready(function() {
   finna.nkr.initAutoOpen();
});
JS;
  ?>
<?php endif ?>
    
<?php if ($setupJS): ?>
  <?= $this->headScript()->appendFile('finna-nkr.js'); ?>
  <? $this->headScript()->appendScript($setupJS); ?>  
<?php endif ?>
<!-- END of: finna - Helpers/nkrRestrictedRecordPermission.phtml -->
