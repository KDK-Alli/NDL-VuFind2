<!-- START of: finna - dynamiclist/results.phtml -->
<?php if($this->noSupport): ?>
    <div class="title-list-error"><?=$this->flashmessages()?></div>
<?php else: ?>
    <div class="title-list-results">
        <?php ob_start(); ?>
        <div class="pagination-container">
            <?=$paginator ? $this->paginationControl($paginator, 'Sliding', 'Helpers/pagination-simple.phtml', ['params' => $this->ilsParams]) : ''?>
        </div>
        <?php
            $paginator = ob_get_contents();
            ob_end_clean();
        ?>
        <?= $paginator ?>
        <div class="title-list-header">
            <h1><?=$this->transEsc("title_list_$this->query")?></h1>
        </div>
        <?php foreach($this->records as $record): ?>
            <div class="title-list-result">
            <?php
                $ilsDetails = $record->getExtraDetail('ils_details');
                $isRecord = is_a($record, 'VuFind\\RecordDriver\\SolrDefault');
                $formats = $record->tryMethod('getFormats');
                $format = $isRecord && $formats ? $this->record($record)->getFormatClass(end($formats)) : 'book';
                $thumb = $isRecord ? $this->recordImage($this->record($record))->getLargeImage() . '&w=1024&h=1024&imgext=.jpeg' : false;
                $author = $isRecord ? $record->getPrimaryAuthorForSearch() : $ilsDetails['author'];
                $year = $isRecord ? ($record->getPublicationDates()[0] ?? '') : $ilsDetails['year'];
            ?>
                <div class="title-list-image-wrapper">
                    <?php if ($isRecord): ?>
                        <?php if ($thumb): ?>
                            <a href="<?=$this->recordLink()->getUrl($record)?>">
                                <img class="title-list-image" data-src="<?=$this->escapeHtmlAttr($thumb)?>" alt="<?=$this->transEsc("Cover Image");?>">
                            </a>
                        <?php endif; ?>
                    <?php endif; ?>
                    <div class="title-list-icon <?= ($isRecord && $thumb ? 'hidden' : '');?>">
                        <span class="iconlabel format-<?=$format?>"></span>
                    </div>
                </div>
                <div class="title-list-info">
                    <div class="title-list-title">
                        <?php if ($isRecord): ?>
                            <a href="<?= $this->url('record', ['id' => $ilsDetails['id']])?>">
                        <?php endif; ?>
                        <p><?= substr($record->getTitle(), 0, 80) ?></p>
                        <?php if ($isRecord): ?>
                            </a>
                        <?php endif; ?>
                    </div>
                    <div class="title-list-generic">
                        <?php if ($isRecord): ?>
                            <p>
                                <?=$this->record($record)->getFormatList() ?> <?=$this->record($record)->getSourceIdElement() ?>
                            </p>
                        <?php endif; ?>
                        <p><?= $this->escapeHtml($author);?></p>
                        <p><?= $this->escapeHtml($year);?></p>
                    </div>
                </div>
                <?php if ($isRecord): ?>
                    </a>
                <?php endif; ?>
            </div>
        <?php endforeach; ?>
        <?= $paginator ?>
    </div>
<?php endif; ?>
<!-- END of: finna - dynamiclist/results.phtml -->
