<!-- START of: finna - ajax/feed-carousel.phtml -->
<?php
  $clickableElement = !$this->touchDevice && !isset($this->linkText);
  $clickableLink = !$clickableElement;
?>

<div class="carousel">
  <?php if ($this->title || $this->translateTitle): ?>
    <h2 class="carousel-header"><?= $this->translateTitle ? $this->transEsc($this->translateTitle) : $this->title; ?></h2>
  <?php endif; ?>
  <?php if (isset($this->description)): ?>
    <p class="additional-description"><?= $this->translate($this->description)?></p>
  <?php endif; ?>
  <div class="carousel-feed">
    <?php $items = isset($this->visualItems) ? array_splice($this->items, 0, $this->visualItems) : $this->items; ?>
    <?php foreach($items as $item): ?>
    <?php
    $linkElement = [
      'href' => $item['link'],
    ];
    if ($this->linkTarget) {
      $linkElement['target'] = $this->linkTarget;
    }
    if ($item['modal']) {
      $linkElement['data-lightbox'] = '';
      $linkElement['data-lightbox-title'] = $item['title'];
    }
    $linkText = $this->transEsc($this->linkText ? $this->linkText : 'To the record');
    ?>
      <div>
        <a <?= $this->htmlElement()->getAttributes($linkElement); ?>>
          <?php if (isset($item['title'])): ?>
            <div class="carousel-slide-header">
              <p><?= $this->truncate($item['title'], 70); ?></p>
            </div>
          <?php endif; ?>
          <?php if (isset($item['text']) || $clickableLink): ?>
            <div class="sr-only">
              <p><?= $item['text']; ?></p>
              <?php if ($clickableLink): ?>
                <span class="carousel-description"><?= $linkText ?></span>
              <?php endif; ?>
            </div>
            <div class="carousel-text" aria-hidden="true">
              <?php if (isset($item['title'])): ?>
                <p class="carousel-hover-title"><?= $this->truncate($item['title'], 70); ?></p>
              <?php endif; ?>
              <?php if (isset($item['dtstart'])): ?>
                <p><i class="fa fa-calendar"></i> <?= $item['dtstart']; ?>
              <?php endif; ?>
              <?php if (isset($item['dtend']) && $item['dtstart'] !== $item['dtend']): ?>
                - <?= $item['dtend']; ?></p>
              <?php elseif (isset($item['dtstart']) && $item['dtstart'] === $item['dtend']): ?>
                <p><i class="fa fa-clock-o"></i> <?= $item['timestart'] . ' - ' . $item['timeend']; ?>
              <?php endif; ?>
              <?php if (isset($item['location'])): ?>
                <p><i class="fa fa-map-marker"></i> <?= $item['location']; ?></p>
              <?php endif; ?>
              <p><?= $item['text']; ?></p>
              <?php if ($clickableLink): ?>
                <span class="carousel-description"><?= $linkText ?></span>
              <?php endif; ?>
            </div>
          <?php endif; ?>
          <?php if (isset($item['image']) && isset($item['image']['url'])): ?>
            <div class="wrapper" aria-hidden="true">
              <img data-lazy="<?= $item['image']['url']; ?>" alt="<?=$this->transEsc("Image");?>: <?php if (isset($item['title'])): ?><?= $item['title']; ?><?php endif; ?>" />
            </div>
          <?php endif; ?>
        </a>
      </div>
    <?php endforeach; ?>
  </div>
</div>
<!-- END of: finna - ajax/feed-carousel.phtml -->
