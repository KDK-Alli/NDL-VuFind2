<?php if ($recs = $this->recommend->getRecommendations()): ?>
  <!-- START of: finna - Recommend/Ontology.phtml -->
  <div id="ontology-recommendations" data-search-id="<?= $this->recommend->getSearchId() ?>">
    <?php $index = 0; ?>
    <?php foreach ($recs as $type => $typeRecs): ?>
      <div class="result-type result-type-<?= $type ?>" data-result-type="<?= $type ?>">
      <?php foreach ($typeRecs as $term => $termRecs): ?>
        <div class="ontology-recommendation alert alert-info" data-term="<?= $this->escapeHtmlAttr($term) ?>">
          <p><?= $this->transEsc(
            'ontology_recommendation_' . $type,
            ['%%term%%' => $term, '%%results_count%%' => count($termRecs)]
          ) ?>
          <?php if (1 === count($termRecs)): ?>
              <?php $index += 1; ?>
              <a href="<?= $termRecs[0]['href'] ?>" data-index="<?= $index ?>">'<?= $termRecs[0]['label'] ?>'</a>
            </p>
          <?php else: ?>
            </p>
            <ul<?php if (count($termRecs) > 5):?> class="truncate-field" data-rows="1"<?php endif;?>>
              <?php foreach ($termRecs as $termRec): ?>
                <?php $index += 1; ?>
                <li><a href="<?= $termRec['href'] ?>" data-index="<?= $index ?>"><?= $termRec['label'] ?></a></li>
              <?php endforeach; ?>
            </ul>
          <?php endif; ?>
        </div>
      <?php endforeach; ?>
      </div>
    <?php endforeach; ?>
  </div>
  <?php
    $this->headScript()->appendFile('finna-recommendation-memory.js');
    $script = <<<EOT
    $('.ontology-recommendation a').each(function() {
      $(this).click(function() {
        var key = $(this).parents('#ontology-recommendations').data('search-id') + '-' + $(this).data('index');
        var recTerm = $(this).text();
        var origTerm = $(this).parents('.ontology-recommendation').data('term');
        var recType = $(this).parents('.result-type').data('result-type');
        var value = finna.recommendationMemory.getDataString('Ontology', recTerm, origTerm, recType); 
        finna.common.setCookie(key, value);
        $(this).attr(
          'href', 
          $(this).attr('href') + '&' + finna.recommendationMemory.PARAMETER_NAME + '=' + key
        );
      });
    });
EOT;
    echo $this->inlineScript(\Laminas\View\Helper\HeadScript::SCRIPT, $script, 'SET');
  ?>
  <!-- END of: finna - Recommend/Ontology.phtml -->
<?php endif; ?>
